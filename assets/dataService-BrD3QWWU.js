import{c as S,i as o,f as y,s as r,d as p,e as d,h as m,k as l,p as i,l as f,m as b,n as D,o as w,q as I,t as h,v as A,w as k,x as L,y as H,z as v,A as B,B as T}from"./index-BssUgnt6.js";const u={subjects:["Physics","Chemistry","Math","Biology","ICT","English","Bengali"],types:["Class","Assignment","Quiz","Exam","Lab","Presentation","Project"],statuses:["Not Started","In Progress","Completed"],priorities:["Low","Medium","Urgent"],language:"en",countdownDate:void 0,countdownLabel:"Exam"},R={subjects:["পদার্থবিজ্ঞান","রসায়ন","গণিত","জীববিজ্ঞান","ICT","ইংরেজি","বাংলা"],types:["ক্লাস","অ্যাসাইনমেন্ট","কুইজ","পরীক্ষা","ল্যাব","প্রেজেন্টেশন","প্রজেক্ট"],statuses:["শুরু হয়নি","চলমান","সম্পন্ন"],priorities:["কম","মাঝারি","জরুরি"],language:"bn",countdownDate:void 0,countdownLabel:"পরীক্ষা"};let E=null;const x=async e=>{if(!e)return console.error("getAssignments: No userId provided"),[];const s=p(e);return console.log("[Data] Returning local assignments immediately:",s.length),o()&&_(e,s),s.map(t=>({id:t.id,userId:t.userId,title:t.title,description:t.description,subject:t.subject,dueDate:t.dueDate,startTime:t.startTime,endTime:t.endTime,status:t.status,priority:t.priority,type:t.type,weight:t.weight,score:t.score,totalPoints:t.totalPoints,createdAt:t.createdAt})).sort((t,a)=>t.dueDate-a.dueDate)},_=async(e,s)=>{try{console.log("[Data] Background sync: Fetching remote assignments...");const t=await L(e);console.log("[Data] Background sync: Remote assignments:",t.length);const a=H(s,t);v(e,a),E&&(a.length,s.length),i()}catch(t){console.warn("[Data] Background sync failed for assignments:",t)}},C=async e=>{if(!e.userId)throw new Error("userId is required");const s=w(),t=Date.now(),a={...e,id:s,createdAt:t,updatedAt:t,syncStatus:"pending"};return m(e.userId,a),console.log("[Data] Assignment saved locally:",s),l({type:"add",collection:"assignments",docId:s,data:a,userId:e.userId}),o()&&i(),s},F=async(e,s)=>{const t=s.userId||"",c=p(t).find(n=>n.id===e);if(c){const n={...c,...s,updatedAt:Date.now(),syncStatus:"pending"};m(t,n),console.log("[Data] Assignment updated locally:",e),l({type:"update",collection:"assignments",docId:e,data:n,userId:t}),o()&&i()}else o()&&await f(b(D,"assignments",e),s)},q=async e=>{const s=Object.keys(localStorage).filter(a=>a.startsWith("ogrogoti_assignments_"));let t="";for(const a of s)if(JSON.parse(localStorage.getItem(a)||"[]").some(n=>n.id===e)){t=a.replace("ogrogoti_assignments_","");break}t&&(I(t,e),console.log("[Data] Assignment deleted locally:",e),l({type:"delete",collection:"assignments",docId:e,userId:t})),o()&&i()};let j=null;const U=async e=>{if(!e)return[];const s=d(e);return console.log("[Data] Returning local habits immediately:",s.length),o()&&O(e,s),s.map(t=>({id:t.id,userId:t.userId,title:t.title,description:t.description,completedDates:t.completedDates,streak:t.streak,order:t.order,createdAt:t.createdAt})).sort((t,a)=>(t.order??1/0)-(a.order??1/0))},z=async(e,s)=>{if(!e)return;const t=d(e),a=Date.now(),c=t.map(n=>{const g=s.indexOf(n.id);return{...n,order:g>=0?g:9999,updatedAt:a,syncStatus:"pending"}});h(e,c),console.log("[Data] Habits reordered locally"),c.forEach(n=>{l({type:"update",collection:"habits",docId:n.id,data:n,userId:e})}),o()&&i()},O=async(e,s)=>{try{console.log("[Data] Background sync: Fetching remote habits...");const t=await B(e);console.log("[Data] Background sync: Remote habits:",t.length);const a=T(s,t);h(e,a),j&&(a.length,s.length),i()}catch(t){console.warn("[Data] Background sync failed for habits:",t)}},G=async e=>{if(!e.userId)throw new Error("userId is required");const s=w(),t=Date.now(),a={...e,id:s,createdAt:t,updatedAt:t,syncStatus:"pending"};return A(e.userId,a),console.log("[Data] Habit saved locally:",s),l({type:"add",collection:"habits",docId:s,data:a,userId:e.userId}),o()&&i(),s},J=async(e,s)=>{const t=s.userId||"",c=d(t).find(n=>n.id===e);if(c){const n={...c,...s,updatedAt:Date.now(),syncStatus:"pending"};A(t,n),console.log("[Data] Habit updated locally:",e),l({type:"update",collection:"habits",docId:e,data:n,userId:t}),o()&&i()}else o()&&await f(b(D,"habits",e),s)},K=async e=>{const s=Object.keys(localStorage).filter(a=>a.startsWith("ogrogoti_habits_"));let t="";for(const a of s)if(JSON.parse(localStorage.getItem(a)||"[]").some(n=>n.id===e)){t=a.replace("ogrogoti_habits_","");break}t&&(k(t,e),console.log("[Data] Habit deleted locally:",e),l({type:"delete",collection:"habits",docId:e,userId:t})),o()&&i()},M=async e=>{if(!e)return u;const s=S(e);return s?(console.log("[Data] Returning local settings immediately"),o()&&N(e,s),{subjects:s.subjects,types:s.types,statuses:s.statuses,priorities:s.priorities,language:s.language,countdownDate:s.countdownDate,countdownLabel:s.countdownLabel}):(console.log("[Data] No local settings, using defaults"),o()&&y(e).then(t=>{t&&r(e,{...t,updatedAt:t.updatedAt||Date.now(),syncStatus:"synced"})}).catch(t=>console.warn("[Data] Failed to fetch settings:",t)),u)},N=async(e,s)=>{try{const t=await y(e);if(t&&s.syncStatus==="synced"){const a=t.updatedAt||0;a>s.updatedAt&&r(e,{...t,updatedAt:a,syncStatus:"synced"})}}catch(t){console.warn("[Data] Background settings sync failed:",t)}},W=async(e,s)=>{if(!e)throw new Error("userId is required");const t={...s,updatedAt:Date.now(),syncStatus:"pending"};r(e,t),console.log("[Data] Settings saved locally"),l({type:"update",collection:"settings",docId:e,data:t,userId:e}),o()&&i()};export{u as D,U as a,R as b,W as c,K as d,x as e,F as f,M as g,C as h,q as i,z as r,G as s,J as u};
