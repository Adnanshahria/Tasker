import{j as e,r as x,H as W,C as _,a as q}from"./index-BssUgnt6.js";import{D as B,a as K,g as Z,r as ee,u as te,s as se,d as re}from"./dataService-BrD3QWWU.js";import{T as ae,F as le,C as de}from"./ConfirmModal-CRWnjeAs.js";import{C as T}from"./check-C-U40vkd.js";import{C as Y,P as ne,G as oe,e as ie,s as ce}from"./startOfMonth-1y-P1Z-x.js";import{R as me}from"./index-JUDBzz5D.js";import{t as xe,n as pe,i as I,f as G,C as be,s as he,e as ue}from"./format-CBulDdCC.js";import{X as $}from"./x-C68OsGd_.js";import"./createLucideIcon-CLzGpuWI.js";function ge(s){return+xe(s)<Date.now()}function fe(s,l,a){const[i,n]=pe(a==null?void 0:a.in,s,l);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()}const je={en:{title:"Habit Tracker",addHabit:"Add Habit",habitName:"Habit Name",description:"Description",del:"Del",none:"No habits yet",clickAdd:'Click "Add Habit" to start',addNew:"Add new habit...",pressEnter:"Press Enter to save",deleteTitle:"Delete Habit",deleteMsg:"Delete this habit? Progress will be lost.",delete:"Delete",cancel:"Cancel",enterName:"Habit name...",enterDesc:"Description (optional)"},bn:{title:"অভ্যাস ট্র্যাকার",addHabit:"নতুন অভ্যাস",habitName:"অভ্যাসের নাম",description:"বিবরণ",del:"মুছুন",none:"কোনো অভ্যাস নেই",clickAdd:'"নতুন অভ্যাস" ক্লিক করুন',addNew:"নতুন অভ্যাস যোগ করুন...",pressEnter:"Enter চাপুন",deleteTitle:"মুছে ফেলুন",deleteMsg:"মুছে ফেলতে চান?",delete:"মুছুন",cancel:"বাতিল",enterName:"অভ্যাসের নাম...",enterDesc:"বিবরণ (ঐচ্ছিক)"}},L=["January","February","March","April","May","June","July","August","September","October","November","December"],Ne=({title:s,addLabel:l,selectedMonth:a,selectedYear:i,showPicker:n,yearOptions:u,onPickerToggle:v,onMonthSelect:g,onYearSelect:D,onAddClick:N})=>e.jsxs("div",{className:"bg-gradient-to-r from-emerald-600/20 to-teal-600/10 border border-emerald-500/20 p-2 md:p-3 rounded-2xl flex flex-wrap items-center justify-between gap-2 md:gap-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 flex-wrap",children:[e.jsxs("h2",{className:"text-xs md:text-lg font-bold text-white px-2 md:px-3 border-r border-white/10 flex items-center gap-1.5 md:gap-2",children:[e.jsxs("span",{className:"w-6 h-6 md:w-8 md:h-8 bg-emerald-500 rounded-lg flex items-center justify-center shadow-lg shadow-emerald-500/30",children:[e.jsx(T,{size:12,strokeWidth:3,className:"md:hidden"}),e.jsx(T,{size:18,strokeWidth:3,className:"hidden md:block"})]}),e.jsx("span",{className:"hidden sm:inline",children:s})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:v,className:"flex items-center gap-1 md:gap-2 px-2 md:px-4 py-1.5 md:py-2 bg-slate-800 border border-slate-600 rounded-xl text-white text-xs md:text-sm font-medium hover:bg-slate-700",children:[L[a]," ",i,e.jsx(Y,{size:14,className:"md:hidden transition-transform",style:{transform:n?"rotate(180deg)":"none"}}),e.jsx(Y,{size:16,className:"hidden md:block transition-transform",style:{transform:n?"rotate(180deg)":"none"}})]}),n&&e.jsxs("div",{className:"absolute top-full mt-2 left-0 bg-slate-800 border border-slate-600 rounded-xl p-4 shadow-2xl z-50 min-w-[280px]",children:[e.jsx("select",{value:i,onChange:o=>D(Number(o.target.value)),className:"w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-white text-sm outline-none mb-3",children:u.map(o=>e.jsx("option",{value:o,children:o},o))}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:L.map((o,y)=>e.jsx("button",{onClick:()=>g(y),className:`px-3 py-2 rounded-lg text-xs font-medium transition-all ${a===y?"bg-emerald-500 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"}`,children:o.slice(0,3)},o))})]})]})]}),e.jsxs("button",{onClick:N,className:"flex items-center gap-1 md:gap-2 bg-emerald-500 hover:bg-emerald-400 text-white px-2 md:px-4 py-1.5 md:py-2 rounded-xl text-xs md:text-sm font-bold shadow-lg shadow-emerald-500/30 hover:scale-105 transition-all shrink-0",children:[e.jsx(ne,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:l})]})]}),J=(s,l)=>s.completedDates.some(a=>I(new Date(a),l)),R=(s,l)=>{const a=l.filter(i=>J(s,i)).length;return Math.round(a/l.length*100)},we=(s,l)=>{const a=G(l,"yyyy-MM-dd");return s.completedDates.includes(a)?s.completedDates.filter(n=>n!==a):[...s.completedDates,a]},ve=({isOpen:s,title:l,description:a,onClose:i})=>{if(!s)return null;const n=e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-3 bg-black/80 backdrop-blur-lg",onClick:i,children:e.jsxs(_.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"bg-gradient-to-br from-slate-800 to-slate-900 border border-emerald-500/30 rounded-2xl p-5 w-full max-w-md shadow-2xl mx-2",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-emerald-500/20 rounded-lg flex items-center justify-center",children:e.jsx(le,{size:16,className:"text-emerald-400"})}),e.jsx("h3",{className:"text-lg font-bold text-white",children:l})]}),e.jsx("button",{onClick:i,className:"p-1.5 bg-slate-700/50 hover:bg-slate-600/50 rounded-lg text-slate-400 hover:text-white transition-colors",children:e.jsx($,{size:16})})]}),e.jsx("div",{className:"bg-slate-900/50 border border-slate-700/50 rounded-xl p-4",children:e.jsx("p",{className:"text-sm text-slate-300 leading-relaxed whitespace-pre-wrap",children:a||"No description available."})}),e.jsx("button",{onClick:i,className:"w-full mt-4 py-2.5 rounded-xl bg-emerald-600/80 hover:bg-emerald-500/80 text-white font-medium transition-colors",children:"Close"})]})});return me.createPortal(n,document.body)},De=({habits:s,daysInMonth:l,t:a,lang:i,onToggle:n,onDelete:u,onReorder:v})=>{const[g,D]=x.useState({isOpen:!1,title:"",description:""}),[N,o]=x.useState(null),[y,k]=x.useState(null),O=t=>{D({isOpen:!0,title:t.title,description:t.description||""})},A=()=>{D({isOpen:!1,title:"",description:""})},S=(t,p)=>{o(p),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",p)},z=(t,p)=>{t.preventDefault(),t.dataTransfer.dropEffect="move",p!==N&&k(p)},E=()=>{k(null)},H=(t,p)=>{t.preventDefault();const d=t.dataTransfer.getData("text/plain");if(d&&d!==p&&v){const f=s.findIndex(b=>b.id===d),C=s.findIndex(b=>b.id===p);if(f!==-1&&C!==-1){const b=[...s],[w]=b.splice(f,1);b.splice(C,0,w),v(b.map(c=>c.id))}}o(null),k(null)},P=()=>{o(null),k(null)};return e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"w-full text-left border-separate border-spacing-0",children:[e.jsx("thead",{className:"sticky top-0 z-10",children:e.jsxs("tr",{className:"bg-gradient-to-r from-slate-800 to-slate-800/90 backdrop-blur-sm text-slate-300 text-[10px] md:text-xs font-bold border-b-2 border-emerald-500/30",children:[e.jsx("th",{className:"w-12 p-2 md:p-3 text-center text-slate-500 bg-slate-800 border-b border-r border-slate-600/50 sticky left-0 z-20",children:"#"}),e.jsx("th",{className:"p-2 md:p-3 border-b border-r border-slate-600/50 w-[100px] md:w-[140px] bg-slate-800 sticky left-12 z-20",children:a.habitName}),l.map(t=>e.jsx("th",{className:`p-0.5 md:p-1 border-r border-slate-600/50 w-7 md:w-8 text-center ${I(t,new Date)&&fe(t,new Date)?"bg-emerald-500/30 text-emerald-300":""}`,children:G(t,"d")},t.toISOString())),e.jsx("th",{className:"p-1 md:p-2 border-r border-slate-600/50 w-[40px] md:w-[50px] text-center",children:"%"}),e.jsx("th",{className:"p-1 md:p-2 w-[32px] md:w-[40px] text-center",children:a.del})]})}),e.jsx("tbody",{className:"bg-slate-900/50 text-xs md:text-sm",children:e.jsx(W,{children:s.map((t,p)=>e.jsxs(_.tr,{initial:{opacity:0},animate:{opacity:1},draggable:!0,onDragStart:d=>S(d,t.id),onDragOver:d=>z(d,t.id),onDragLeave:E,onDrop:d=>H(d,t.id),onDragEnd:P,className:`group transition-colors border-b border-slate-700/50 
                                    ${N===t.id?"opacity-50 bg-slate-700":"hover:bg-emerald-500/5"}
                                    ${y===t.id?"border-t-2 border-t-emerald-500":""}`,children:[e.jsx("td",{className:"w-12 text-center text-[10px] md:text-xs text-slate-500 bg-slate-800 font-mono p-1 md:p-2 border-b border-r border-slate-700/50 sticky left-0 z-10",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("span",{className:"cursor-grab active:cursor-grabbing p-1 hover:bg-emerald-500/20 rounded transition-colors",title:"Drag to reorder",children:e.jsx(oe,{size:14,className:"text-slate-400 hover:text-emerald-400 transition-colors"})}),e.jsx("span",{className:"text-slate-500",children:p+1})]})}),e.jsx("td",{className:"p-0 border-b border-r border-slate-700/50 bg-slate-900 sticky left-12 z-10",children:e.jsxs("div",{className:"px-1.5 md:px-2 py-1.5 md:py-2 flex items-center gap-1",children:[e.jsx("span",{className:"text-slate-200 font-medium truncate text-xs md:text-sm flex-1",children:t.title}),e.jsx("button",{onClick:()=>O(t),className:`p-0.5 transition-colors flex-shrink-0 rounded ${t.description?"text-emerald-400 hover:text-emerald-300 bg-emerald-500/10 hover:bg-emerald-500/20":"text-slate-500 hover:text-slate-400 bg-slate-700/30 hover:bg-slate-700/50"}`,title:t.description?"View description":"No description",children:e.jsx(be,{size:12})})]})}),l.map(d=>{const f=J(t,d),C=I(d,new Date),w=ge(he(d))&&!C&&!f;return e.jsx("td",{className:"p-0 border-r border-slate-700/50 text-center",children:e.jsxs("button",{onClick:()=>n(t,d),className:`w-full h-8 md:h-9 flex items-center justify-center transition-all ${f?"bg-emerald-500/30 text-emerald-400":w?"bg-red-500/10 text-red-400/60":"hover:bg-slate-800"}`,children:[f&&e.jsx(T,{size:12,strokeWidth:3,className:"md:hidden"}),f&&e.jsx(T,{size:14,strokeWidth:3,className:"hidden md:block"}),w&&e.jsx($,{size:10,strokeWidth:2,className:"md:hidden"}),w&&e.jsx($,{size:12,strokeWidth:2,className:"hidden md:block"})]})},d.toISOString())}),e.jsxs("td",{className:"p-1 md:p-2 border-r border-slate-700/50 text-center font-mono text-[10px] md:text-xs font-bold",style:{color:`hsl(${R(t,l)*1.2}, 70%, 50%)`},children:[R(t,l),"%"]}),e.jsx("td",{className:"p-1 md:p-2 text-center",children:e.jsx("button",{onClick:()=>u(t.id),className:"p-1 md:p-1.5 hover:bg-red-500 hover:text-white rounded-lg text-slate-400 md:opacity-0 md:group-hover:opacity-100 transition-all",children:e.jsx(ae,{size:12})})})]},t.id))})})]}),e.jsx(W,{children:g.isOpen&&e.jsx(ve,{isOpen:g.isOpen,title:g.title,description:g.description,onClose:A})})]})},Ee=()=>{const{currentUser:s}=q(),[l,a]=x.useState([]),[i,n]=x.useState(!1),[u,v]=x.useState(""),[g,D]=x.useState(""),[N,o]=x.useState(null),[y,k]=x.useState(B),[O,A]=x.useState(!0),S=new Date,[z,E]=x.useState(S.getMonth()),[H,P]=x.useState(S.getFullYear()),[t,p]=x.useState(!1),d=new Date(H,z,1),f=ue({start:ce(d),end:ie(d)}),C=Array.from({length:11},(r,h)=>S.getFullYear()-5+h),b=async()=>{if(s){try{const[r,h]=await Promise.all([K(s.uid),Z(s.uid)]);a(r),k(h)}catch(r){console.error("Error loading data:",r)}A(!1)}};x.useEffect(()=>{b()},[s]);const w=y.language||"bn",c=je[w],U=async()=>{if(!(!u.trim()||!s))try{await se({userId:s.uid,title:u,description:g,completedDates:[],streak:0,createdAt:Date.now()}),v(""),D(""),n(!1),await b()}catch(r){console.error("Error adding habit:",r)}},V=async(r,h)=>{if(!s)return;const m=we(r,h);a(j=>j.map(M=>M.id===r.id?{...M,completedDates:m}:M));try{await te(r.id,{userId:s.uid,completedDates:m})}catch(j){console.error("Error toggling habit:",j),a(M=>M.map(F=>F.id===r.id?{...F,completedDates:r.completedDates}:F))}},Q=async r=>{const h=l.find(m=>m.id===r);a(m=>m.filter(j=>j.id!==r)),o(null);try{await re(r)}catch(m){console.error("Error deleting habit:",m),h&&a(j=>[...j,h])}},X=async r=>{if(!s)return;const h=r.map(m=>l.find(j=>j.id===m)).filter(m=>m!==void 0);a(h);try{await ee(s.uid,r)}catch(m){console.error("Error reordering habits:",m),await b()}};return O?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-emerald-500"})}):e.jsxs("div",{className:"h-full flex flex-col space-y-4 font-sans",children:[e.jsx(Ne,{title:c.title,addLabel:c.addHabit,selectedMonth:z,selectedYear:H,showPicker:t,yearOptions:C,onPickerToggle:()=>p(!t),onMonthSelect:r=>{E(r),p(!1)},onYearSelect:P,onAddClick:()=>n(!0)}),e.jsx("div",{className:"flex-1 bg-slate-900/80 backdrop-blur-sm border border-white/10 rounded-2xl overflow-hidden flex flex-col shadow-xl",children:e.jsxs("div",{className:"overflow-x-auto flex-1 custom-scrollbar",children:[e.jsx(De,{habits:l,daysInMonth:f,t:c,lang:w,onToggle:V,onDelete:o,onReorder:X}),l.length===0&&e.jsx(ye,{t:c})]})}),i&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",onClick:()=>n(!1),children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 border border-emerald-500/30 rounded-2xl p-6 w-full max-w-md shadow-2xl",onClick:r=>r.stopPropagation(),children:[e.jsx("h3",{className:"text-xl font-bold bg-gradient-to-r from-emerald-400 to-teal-400 bg-clip-text text-transparent mb-4",children:c.addHabit}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{value:u,onChange:r=>v(r.target.value),placeholder:c.enterName,className:"w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-white outline-none focus:border-emerald-500",autoFocus:!0}),e.jsx("textarea",{value:g,onChange:r=>D(r.target.value),rows:2,placeholder:c.enterDesc,className:"w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-white outline-none focus:border-emerald-500 resize-none"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>n(!1),className:"flex-1 py-2.5 rounded-xl bg-slate-700 text-slate-300 hover:bg-slate-600 font-medium",children:c.cancel}),e.jsx("button",{onClick:U,className:"flex-1 py-2.5 rounded-xl bg-gradient-to-r from-emerald-600 to-teal-600 text-white hover:from-emerald-500 hover:to-teal-500 font-medium shadow-lg shadow-emerald-500/25",children:c.addHabit})]})]})]})}),e.jsx(de,{isOpen:!!N,title:c.deleteTitle,message:c.deleteMsg,confirmText:c.delete,cancelText:c.cancel,onConfirm:()=>N&&Q(N),onCancel:()=>o(null)})]})},ye=({t:s})=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-slate-500",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-emerald-500/20 to-teal-500/10 rounded-2xl flex items-center justify-center mb-4 border border-emerald-500/20",children:e.jsx(T,{size:32,className:"text-emerald-400"})}),e.jsx("p",{className:"text-lg font-medium",children:s.none}),e.jsx("p",{className:"text-sm",children:s.clickAdd})]});export{L as MONTHS,je as T,R as calculateCompletionRate,Ee as default,J as isHabitCompletedOnDate,we as toggleHabitDate};
